networks:
    default:
        name: court-1

services:
    mysql:
        container_name: court-1-mysql
        image: mysql:8.4.7
        ports:
            - 3306:3306
        command:
            [
                "--character-set-server=utf8mb4",
                "--collation-server=utf8mb4_general_ci"
            ]
        volumes:
            - ../data/mysql:/var/lib/mysql
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: "Court-1.Root@123"
            MYSQL_DATABASE: "court_1"

    redis:
        container_name: court-1-redis
        image: redis:8
        ports:
            - 6379:6379
        restart: always

    directus:
        container_name: court-1-directus
        image: directus/directus:11.14.0
        ports:
            - 8055:8055
        depends_on:
            - mysql
            - redis
        volumes:
            - ../data/directus/extensions:/directus/extensions
            - ../data/directus/templates:/directus/templates
            - ../data/directus/uploads:/directus/uploads
        restart: always
        environment:
            KEY: "KEY-ABC-XYZ-123-END"
            SECRET: "SECRET-ABC-XYZ-123-END"
            PUBLIC_URL: "https://cuddly-trout-4jv547pr97v43qgx-8055.app.github.dev"
            ADMIN_EMAIL: "admin@example.com"
            ADMIN_PASSWORD: "Court-1.Admin@123"
            WEBSOCKETS_ENABLED: true
            DB_CLIENT: "mysql"
            DB_HOST: "mysql"
            DB_PORT: 3306
            DB_USER: "root"
            DB_PASSWORD: "Court-1.Root@123"
            DB_DATABASE: "court_1"
            CACHE_ENABLED: true
            CACHE_STORE: "redis"
            CACHE_AUTO_PURGE: true
            REDIS: "redis://redis:6379"

    next:
        container_name: court-1-next
        build:
            context: ../source
            dockerfile: next.dockerfile
            args:
                DATA_URL: https://cuddly-trout-4jv547pr97v43qgx-8055.app.github.dev
                DATA_NAME: Directus
                COOKIE_NAME: court_session_token
                NEXT_PUBLIC_DATA_URL: https://cuddly-trout-4jv547pr97v43qgx-8055.app.github.dev
        ports:
            - 3000:3000
        depends_on:
            - directus
        volumes:
            - ../source/src:/next/src
        restart: always